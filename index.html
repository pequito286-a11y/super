<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pequito Lovers - Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        .pequito-gradient { background: linear-gradient(135deg, #ea580c 0%, #f97316 100%); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .card-img { width: 100%; height: 160px; object-fit: contain; border-radius: 20px; background: #fff; }
        .promo-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-slate-50 pb-44">
    <header class="pequito-gradient p-8 rounded-b-[50px] shadow-xl text-white text-center relative">
        <button onclick="verificarAcceso()" class="absolute top-6 right-6 opacity-30">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
        </button>
        <h1 class="text-3xl font-black italic uppercase">PEQUITO LOVERS</h1>
        <p class="text-[10px] font-bold uppercase tracking-widest">LA CASA DEL SNACK MIX üç™</p>
    </header>

    <main class="px-6 mt-8">
        <div id="grid-productos" class="grid grid-cols-2 gap-5"></div>
    </main>

    <div id="modalAdmin" class="modal px-4">
        <div class="bg-white w-full max-w-md rounded-[40px] p-8 shadow-2xl space-y-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-black uppercase italic text-slate-800">Panel Admin</h2>
            <div class="space-y-3">
                <input id="inNombre" placeholder="Nombre" class="w-full p-4 bg-slate-50 rounded-2xl outline-none text-sm font-bold uppercase">
                <div class="grid grid-cols-2 gap-2">
                    <input id="inCaja" type="number" placeholder="S/ Caja" class="p-4 bg-slate-50 rounded-2xl text-sm">
                    <input id="inTira" type="number" placeholder="S/ Tira" class="p-4 bg-slate-50 rounded-2xl text-sm">
                </div>
                <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="comprimirFoto(event)">
                <button onclick="document.getElementById('fileInput').click()" class="w-full border-2 border-dashed border-orange-300 text-orange-600 py-4 rounded-2xl font-bold uppercase text-xs">üì∏ Foto del Producto</button>
                <div id="preview" class="hidden"><img id="imgPrev" class="w-full h-32 object-contain rounded-xl border"></div>
                <button onclick="guardarProducto()" class="w-full pequito-gradient text-white py-4 rounded-2xl font-black uppercase">Guardar</button>
            </div>
            <div id="listaEdicion" class="pt-4 border-t space-y-2"></div>
            <button onclick="cerrarModal()" class="w-full text-slate-400 font-bold text-[10px] uppercase mt-4">Cerrar</button>
        </div>
    </div>

    <div id="cart-float" class="hidden fixed bottom-6 left-6 right-6 bg-white p-6 rounded-[40px] shadow-2xl z-50 border-2 border-orange-100">
        <div id="promo-alert" class="hidden mb-3 p-2 bg-green-500 text-white text-[10px] font-bold rounded-xl text-center promo-pulse uppercase">üéÅ ¬°PROMO! 3 Papas 1.00 GRATIS</div>
        <div class="flex justify-between items-center">
            <div class="text-left">
                <p class="text-[10px] font-bold text-slate-400 uppercase">Total Compra:</p>
                <p id="cart-total" class="text-3xl font-black text-slate-800 italic leading-none">S/ 0.00</p>
            </div>
            <button onclick="finalizarPedido()" class="pequito-gradient text-white px-8 py-4 rounded-[25px] font-black uppercase text-xs">Pedir üì≤</button>
        </div>
    </div>
    <script>
        const PIN_ACCESO = "2026";
        let productos = JSON.parse(localStorage.getItem('pequito_db')) || [];
        let carrito = [];
        let tempImg = "";

        function verificarAcceso() { if(prompt("PIN:") === PIN_ACCESO) { document.getElementById('modalAdmin').style.display = 'flex'; renderListaEdicion(); } }

        function comprimirFoto(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 400; canvas.height = 400;
                    ctx.drawImage(img, 0, 0, 400, 400);
                    tempImg = canvas.toDataURL('image/jpeg', 0.7);
                    document.getElementById('imgPrev').src = tempImg;
                    document.getElementById('preview').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function guardarProducto() {
            const n = document.getElementById('inNombre').value.toUpperCase();
            const pC = parseFloat(document.getElementById('inCaja').value) || 0;
            const pT = parseFloat(document.getElementById('inTira').value) || 0;
            if(!n || !tempImg) return alert("Falta nombre o foto");
            productos.push({ n, pC, pT, img: tempImg });
            localStorage.setItem('pequito_db', JSON.stringify(productos));
            limpiarForm(); actualizarTodo();
        }

        function renderPublico() {
            const cont = document.getElementById('grid-productos');
            cont.innerHTML = productos.map((p, i) => `
                <div class="bg-white rounded-[35px] shadow-sm p-4 border border-slate-100 flex flex-col">
                    <img src="${p.img}" class="card-img mb-3">
                    <h4 class="font-black text-slate-800 uppercase text-[10px] mb-2 truncate">${p.n}</h4>
                    <div class="space-y-1">
                        ${p.pC > 0 ? `<button onclick="add('${p.n}', ${p.pC}, 'Caja')" class="w-full bg-slate-50 py-2 rounded-xl text-[9px] font-black uppercase">Caja S/ ${p.pC.toFixed(2)}</button>` : ''}
                        ${p.pT > 0 ? `<button onclick="add('${p.n}', ${p.pT}, 'Tira')" class="w-full pequito-gradient text-white py-2 rounded-xl text-[9px] font-black uppercase">Tira S/ ${p.pT.toFixed(2)}</button>` : ''}
                    </div>
                </div>`).join('');
        }

        function add(n, p, m) {
            carrito.push({ n, p, m });
            const total = carrito.reduce((acc, item) => acc + item.p, 0);
            document.getElementById('cart-float').classList.remove('hidden');
            document.getElementById('cart-total').innerText = `S/ ${total.toFixed(2)}`;
            if(total >= 250) document.getElementById('promo-alert').classList.remove('hidden');
            confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 } });
        }

        function finalizarPedido() {
            const nom = prompt("¬øTu nombre?");
            const dir = prompt("¬øDirecci√≥n en SJL?");
            if(!nom || !dir) return;
            const total = carrito.reduce((acc, item) => acc + item.p, 0);
            let msg = `üç™ *PEDIDO PEQUITO LOVERS*\nüë§ *Cliente:* ${nom.toUpperCase()}\nüìç *Dir:* ${dir.toUpperCase()}\n\n`;
            carrito.forEach(item => { msg += `‚úÖ *1x* ${item.n} (${item.m}) - S/ ${item.p.toFixed(2)}\n`; });
            if(total >= 250) msg += `\nüéÅ *PROMO ACTIVADA: 3 PAPAS 1.00 GRATIS*`;
            msg += `\nüí∞ *TOTAL A PAGAR: S/ ${total.toFixed(2)}*\n\nüëã *¬°Gracias por ser un Pequito Lover!*`;
            window.open(`https://wa.me/51934633112?text=${encodeURIComponent(msg)}`, '_blank');
            carrito = []; document.getElementById('cart-float').classList.add('hidden');
        }

        function renderListaEdicion() {
            document.getElementById('listaEdicion').innerHTML = productos.map((p, i) => `
                <div class="flex justify-between bg-slate-50 p-3 rounded-xl text-[10px] font-bold">
                    <span>${p.n}</span>
                    <button onclick="eliminar(${i})" class="text-red-500">BORRAR</button>
                </div>`).join('');
        }

        function eliminar(i) { if(confirm("¬øBorrar?")) { productos.splice(i, 1); localStorage.setItem('pequito_db', JSON.stringify(productos)); actualizarTodo(); } }
        function actualizarTodo() { renderPublico(); renderListaEdicion(); }
        function cerrarModal() { document.getElementById('modalAdmin').style.display = 'none'; }
        function limpiarForm() { document.getElementById('inNombre').value=''; document.getElementById('inCaja').value=''; document.getElementById('inTira').value=''; document.getElementById('preview').classList.add('hidden'); tempImg=""; }
        actualizarTodo();
    </script>
</body>
</html>
